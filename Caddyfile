portfolio.vthiebaut.fr, www.portfolio.vthiebaut.fr {
    encode zstd gzip

    # --- Redirection www vers apex (AVANT les handle blocks) ---
    @www host www.portfolio.vthiebaut.fr
    redir @www https://portfolio.vthiebaut.fr{uri} permanent

    # --- API Symfony ---
    @api path /api/* /index.php
    handle @api {
        root * /var/www/html/public
        php_fastcgi php:9000
        file_server
    }

    # --- Site statique Nuxt (SSG) ---
    # Réécrire /page vers /page/ pour que file_server trouve page/index.html
    @no_trailing path_regexp no_trailing ^/[^.]*[^/]$
    rewrite @no_trailing {http.request.uri.path}/
    handle {
        root * /var/www/portfolio
        file_server
    }
}
